{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>상세보기</h1>
<div class="container" id="show_detail">
    <h3>{{ product.title }} </h3>
    <h4>남은 개수 : {{ product.stock }} </h4>
    <h4 style="color: red;"> &#8361; {{ product.price }}</h4>
    {% if product.image %}
        <img src="{{ product.image.url }}" alt="이미지" id="product_image">
    {% endif %}
    <h5>{{ product.info }}<br><br>
    등록 : {{ product.created_at }}<br>
    수정 : {{ product.updated_at}}<br>
    판매자 : {{ product.seller }}</h5>
    
    {% if user == product.seller %}
        <a href="{% url 'product:update' product.pk %}" class="btn btn-primary">상품수정</a>
        <a href="{% url 'product:delete' product.pk %}" class="btn btn-danger">상품삭제</a>
    {% else %}
        <a href="{% url 'product:main_list'%}" class="btn btn-dark">목록</a>
    {% endif %}
    <br>
    <!--좋아요 기능-->
    {% if user.is_authenticated %}
    <a href="{% url 'product:like' product.id %}?redirect_to=show">
        {% if user in product.like_users.all %}
            <i class="fas fa-heart"></i></a>
        {% else %}
            <i class="far fa-heart"></i></a>
        {% endif %}
    </a>
    {% endif %}
    이 상품을 {{ product.like_users.count }}명이 좋아합니다.<br><br>

    <!--로그인 했다면 댓글작성-->
    {% if user.is_authenticated %}
        <div class="container">
            <form class="form-row" action="{% url 'product:create_review' product.id %}" method="POST">
                {% csrf_token %}
                <textarea class="form-control col-11 mr-2" name="content" placeholder="리뷰 내용 입력.."></textarea>
                <input type="submit" class="btn btn-dark" value="작성">
            </form>
        </div>
    <!--로그인이 안된경우 로그인 유도-->
    {% else %}
    <div class="container">
        <form class="form-row" action="{% url 'product:create_review' product.id %}" method="POST">
            {% csrf_token %}
            <textarea class="form-control col-11 mr-2" name="content" placeholder="로그인 후 작성이 가능합니다." disabled></textarea>
            <input type="submit" class="btn btn-dark" value="작성">
        </form>
    </div>
    {% endif %}

    <div class="container mt-5 mb-5">
        {% for r in review %}
            <div class="card" style="text-align: left;">
                <div class="card-body">
                    <b>{{ r.reviewer }}</b> : {{ r.content }}<br>
                    <small>{{ r.created_at }}</small>
                    {% if user == r.reviewer  %}
                        <div style="text-align: right;">
                            <a href="#" class="btn btn-dark">수정</a>
                            <a href="{% url 'product:delete_review' r.pk %}" class="btn btn-danger">삭제</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>   
</div>
{% endblock %}